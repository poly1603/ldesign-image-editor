import{d as re,r as g,b as U,o as pe,w as G,a as oe,q as C,x as ae,k as B,u as r,y as ce,e as o,t as I,c as X,j as me,f as N,g as z,h as Y,R as ge,i as D,n as $,T as se,S as fe,M as he,l as A,v as le,m as ee,p as ye,F as ne,s as ie,_ as we}from"./index-SE0NJIgO.js";import{c as be,S as Ce,U as ke,a as xe,X as Te,D as ze,C as Ie,Z as De,K as Re,J as $e}from"./index.es-DlIkaE_g.js";import{S as Ue}from"./settings-DPy8mNFk.js";import{C as Ee,a as _e}from"./copy-C5UYAKMA.js";import{C as Se}from"./chevron-left-CnZcR3IB.js";function Le(f={}){const s=ce(null),h=g(!1),n=g(!1),m=g(null),k=g(null),i=g(!1),d=g(!1),w=g(0),v=g(0);function p(u){s.value&&R();try{const l={container:u,width:f.width,height:f.height,plugins:f.plugins,image:f.image,...f.options},x=new be(l);s.value=x,F(x),w.value=x.width,v.value=x.height}catch(l){throw m.value=l instanceof Error?l:new Error(String(l)),l}}function F(u){u.on("ready",l=>{h.value=!0,n.value=!1,w.value=l.width,v.value=l.height}),u.on("error",l=>{m.value=l.error,n.value=!1}),u.on("tool-change",l=>{k.value=l.tool||null}),u.on("history-change",l=>{i.value=l.canUndo,d.value=l.canRedo}),u.on("image-loaded",l=>{w.value=l.width,v.value=l.height})}async function S(u){if(!s.value)throw new Error("Editor not initialized");n.value=!0,m.value=null;try{await s.value.loadImage(u)}catch(l){throw m.value=l instanceof Error?l:new Error(String(l)),l}finally{n.value=!1}}async function V(u){if(!s.value)throw new Error("Editor not initialized");return s.value.export(u)}function O(){s.value&&s.value.undo()}function H(){s.value&&s.value.redo()}function L(u){s.value&&s.value.setTool(u)}function R(){s.value&&(s.value.destroy(),s.value=null,h.value=!1,n.value=!1,m.value=null,k.value=null,i.value=!1,d.value=!1,w.value=0,v.value=0)}return oe(()=>{R()}),{editor:s,isReady:h,isLoading:n,error:m,currentTool:k,canUndo:i,canRedo:d,width:w,height:v,init:p,loadImage:S,exportImage:V,undo:O,redo:H,setTool:L,destroy:R}}function Pe(f){const s=[];function h(i){return d=>n(i,d)}function n(i,d){f.value&&f.value.on(i,d),s.push({event:i,handler:d});const w=G(()=>f.value,(v,p)=>{p&&p.off(i,d),v&&v.on(i,d)});return()=>{w(),f.value&&f.value.off(i,d);const v=s.findIndex(p=>p.event===i&&p.handler===d);v!==-1&&s.splice(v,1)}}function m(i,d){f.value&&f.value.off(i,d);const w=s.findIndex(v=>v.event===i&&v.handler===d);w!==-1&&s.splice(w,1)}function k(){if(f.value)for(const{event:i,handler:d}of s)f.value.off(i,d);s.length=0}return oe(()=>{k()}),{onReady:h("ready"),onError:h("error"),onImageLoaded:h("image-loaded"),onToolChange:h("tool-change"),onHistoryChange:h("history-change"),onBeforeExport:h("before-export"),onAfterExport:h("after-export"),onDestroy:h("destroy"),on:n,off:m,removeAllListeners:k}}const je={class:"image-editor-error"},Be=re({__name:"ImageEditor",props:{image:{default:void 0},width:{default:void 0},height:{default:void 0},plugins:{default:()=>[]},options:{default:()=>({})}},emits:["ready","error","tool-change","history-change","image-loaded","before-export","after-export","destroy"],setup(f,{expose:s,emit:h}){const n=f,m=h,k=g(),{editor:i,isReady:d,isLoading:w,error:v,currentTool:p,canUndo:F,canRedo:S,width:V,height:O,init:H,loadImage:L,exportImage:R,undo:u,redo:l,setTool:x,destroy:P}=Le({image:n.image,width:n.width,height:n.height,plugins:n.plugins,options:n.options}),{onReady:b,onError:E,onImageLoaded:j,onToolChange:Z,onHistoryChange:Q,onBeforeExport:W,onAfterExport:J,onDestroy:q}=Pe(i);return b(y=>m("ready",y)),E(y=>m("error",y)),j(y=>m("image-loaded",y)),Z(y=>m("tool-change",y)),Q(y=>m("history-change",y)),W(y=>m("before-export",y)),J(y=>m("after-export",y)),q(()=>m("destroy")),pe(()=>{k.value&&H(k.value)}),G(()=>n.image,async y=>{if(y&&i.value)try{await L(y)}catch{}}),oe(()=>{P()}),s({editor:i,isReady:d,isLoading:w,error:v,currentTool:p,canUndo:F,canRedo:S,width:V,height:O,loadImage:L,export:R,undo:u,redo:l,setTool:x}),(y,K)=>(C(),U("div",{ref_key:"containerRef",ref:k,class:"image-editor-container"},[r(w)?ae(y.$slots,"loading",{key:0},()=>[K[0]||(K[0]=o("div",{class:"image-editor-loading"},"Loading...",-1))]):B("",!0),r(v)?ae(y.$slots,"error",{key:1,error:r(v)},()=>[o("div",je,I(r(v).message),1)]):B("",!0)],512))}}),Fe=(f,s)=>{const h=f.__vccOpts||f;for(const[n,m]of s)h[n]=m;return h},Ve=Fe(Be,[["__scopeId","data-v-68e27f8f"]]),Oe={class:"panel-trigger"},He={class:"panel-body"},Me={class:"group-label"},Ne={class:"toggle-list"},Ae=["onClick"],Je={class:"toggle-name"},qe={class:"panel-trigger"},Ke={class:"panel-body"},Ge={class:"setting-item"},Ze={class:"color-picker-row"},Qe={class:"color-value"},We={class:"setting-item"},Xe={class:"setting-item"},Ye={class:"setting-item"},eo={class:"range-row"},oo={class:"range-value"},to=["title"],ao={class:"preview-header"},so={class:"preview-content"},lo={class:"preview-image-wrapper"},no=["src"],io={class:"format-selector"},ro={class:"format-option"},uo={class:"format-option"},vo={key:0,class:"quality-slider"},po={class:"quality-label"},co={class:"preview-info"},mo={class:"info-item"},go={class:"info-value"},fo={class:"info-item"},ho={class:"info-value"},yo={class:"info-item"},wo={class:"info-value"},bo={class:"preview-actions"},Co=["disabled"],ko=["disabled"],xo=["disabled"],To=re({__name:"index",setup(f){const s=g(null),h=g(void 0),{theme:n,toggleTheme:m}=me(),k=[{group:"缩放控件",items:[{id:"zoomOut",name:"缩小"},{id:"zoomIn",name:"放大"},{id:"reset",name:"重置"}]},{group:"绘图工具",items:[{id:"move",name:"移动"},{id:"pen",name:"画笔"},{id:"rect",name:"矩形"},{id:"circle",name:"圆形"},{id:"arrow",name:"箭头"},{id:"line",name:"直线"},{id:"triangle",name:"三角形"},{id:"text",name:"文字"},{id:"mosaic",name:"马赛克"},{id:"eraser",name:"橡皮擦"}]},{group:"图像工具",items:[{id:"crop",name:"裁剪"},{id:"filter",name:"滤镜"}]},{group:"历史记录",items:[{id:"undo",name:"撤销"},{id:"redo",name:"重做"}]},{group:"导出",items:[{id:"export",name:"导出"}]}],i=g(["zoomOut","zoomIn","reset","move","pen","rect","circle","arrow","line","triangle","mosaic","eraser","crop","filter","undo","redo","export"]),d=g(null),w=X({get:()=>d.value==="tools",set:a=>d.value=a?"tools":null}),v=X({get:()=>d.value==="settings",set:a=>d.value=a?"settings":null}),p=g({autoHide:!0,historyLimit:50,responsive:!0,primaryColor:"#667eea"}),F=[De,Re,$e],S=()=>["zoomOut","zoomIn","reset","move","pen","rect","circle","arrow","line","triangle","text","mosaic","eraser","crop","filter","undo","redo","export"].filter(e=>!i.value.includes(e)),V=X(()=>({historyLimit:50,responsive:!0,toolbar:{theme:n.value,autoHide:!0,disabledTools:S()}})),O=a=>{var c;const e=i.value.indexOf(a);e>-1?i.value.splice(e,1):i.value.push(a);const t=(c=s.value)==null?void 0:c.editor;if(t){const T=t._toolbar;T==null||T.setDisabledTools(S())}},H=a=>{var t;p.value.primaryColor=a;const e=(t=s.value)==null?void 0:t.editor;if(e){const c=e._toolbar;c==null||c.setPrimaryColor(a)}},L=()=>{d.value=null},R=g(!1),u=g(""),l=g(null),x=g({width:0,height:0,size:""}),P=g(!1),b=g("png"),E=g(.92),j=g(!1),Z=async a=>{var T;const e=a.target,t=(T=e.files)==null?void 0:T[0];if(!t)return;const c=new FileReader;c.onload=M=>{var _;h.value=(_=M.target)==null?void 0:_.result},c.readAsDataURL(t),e.value=""},Q=a=>{var c,T;a.preventDefault();const e=(T=(c=a.dataTransfer)==null?void 0:c.files)==null?void 0:T[0];if(!(e!=null&&e.type.startsWith("image/")))return;const t=new FileReader;t.onload=M=>{var _;h.value=(_=M.target)==null?void 0:_.result},t.readAsDataURL(e)},W=async()=>{s.value&&(await J(),R.value=!0)},J=async()=>{var a,e;if(s.value)try{const t=b.value,c=t==="jpeg"?E.value:void 0,T=await s.value.export({format:t,type:"base64",quality:c});u.value=T,l.value=await s.value.export({format:t,type:"blob",quality:c});const M=((a=s.value.width)==null?void 0:a.value)??0,_=((e=s.value.height)==null?void 0:e.value)??0;x.value={width:M,height:_,size:K(l.value.size)}}catch(t){console.error("导出失败:",t)}};G([b,E],()=>{R.value&&J()}),G(n,a=>{q(a)});const q=a=>{var t;const e=(t=s.value)==null?void 0:t.editor;if(e){const c=e._toolbar;c==null||c.setTheme(a)}},y=()=>{q(n.value)},K=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(2)+" MB",de=()=>{if(!u.value)return;const a=b.value==="jpeg"?"jpg":"png",e=document.createElement("a");e.href=u.value,e.download=`image-${Date.now()}.${a}`,e.click()},ue=async()=>{if(l.value)try{const a=b.value==="jpeg"?"image/jpeg":"image/png";await navigator.clipboard.write([new ClipboardItem({[a]:l.value})]),P.value=!0,setTimeout(()=>{P.value=!1},2e3)}catch(a){console.error("复制失败:",a)}},te=()=>{R.value=!1,u.value="",l.value=null},ve=async()=>{if(!(!l.value||!u.value)){j.value=!0;try{const a=b.value==="jpeg"?"jpg":"png",e=`image-${Date.now()}.${a}`;alert(`上传方式 1️⃣ FormData (推荐):

const formData = new FormData();
formData.append('file', blob, '${e}');

const response = await fetch('/api/upload', {
  method: 'POST',
  body: formData,
});

上传方式 2️⃣ Base64:

const base64 = '${u.value.substring(0,50)}...';

const response = await fetch('/api/upload', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    image: base64,
    filename: '${e}',
  }),
});

图片信息:
- 文件名: ${e}
- 格式: ${b.value.toUpperCase()}
- 大小: ${x.value.size}
- Base64 长度: ${u.value.length} 字符`)}catch(a){console.error("Upload failed:",a),alert("上传失败: "+a.message)}finally{j.value=!1}}};return(a,e)=>(C(),U("div",{class:$(["editor-page",`theme-${r(n)}`]),onClick:L},[o("header",{class:"editor-header",onClick:e[11]||(e[11]=D(()=>{},["stop"]))},[z(r(ge),{to:"/",class:"back-btn"},{default:Y(()=>[z(r(Se),{size:20}),e[16]||(e[16]=o("span",null,"返回",-1))]),_:1}),e[31]||(e[31]=o("h1",{class:"title"},"图片编辑器 - Vue Demo",-1)),o("div",Oe,[o("button",{class:$(["header-btn",{active:w.value}]),onClick:e[0]||(e[0]=D(t=>w.value=!w.value,["stop"]))},[z(r(Ue),{size:18}),e[17]||(e[17]=o("span",null,"工具配置",-1))],2),z(se,{name:"panel-fade"},{default:Y(()=>[w.value?(C(),U("div",{key:0,class:$(["config-panel",`theme-${r(n)}`]),onClick:e[1]||(e[1]=D(()=>{},["stop"]))},[e[19]||(e[19]=o("div",{class:"panel-header"},[o("span",{class:"panel-title"},"工具栏配置")],-1)),o("div",He,[(C(),U(ne,null,ie(k,t=>o("div",{key:t.group,class:"config-group"},[o("div",Me,I(t.group),1),o("div",Ne,[(C(!0),U(ne,null,ie(t.items,c=>(C(),U("div",{key:c.id,class:"toggle-item",onClick:T=>O(c.id)},[o("span",Je,I(c.name),1),o("div",{class:$(["toggle-switch",{on:i.value.includes(c.id)}])},[...e[18]||(e[18]=[o("div",{class:"toggle-thumb"},null,-1)])],2)],8,Ae))),128))])])),64))])],2)):B("",!0)]),_:1})]),o("div",qe,[o("button",{class:$(["header-btn",{active:v.value}]),onClick:e[2]||(e[2]=D(t=>v.value=!v.value,["stop"]))},[z(r(Ce),{size:18}),e[20]||(e[20]=o("span",null,"属性",-1))],2),z(se,{name:"panel-fade"},{default:Y(()=>[v.value?(C(),U("div",{key:0,class:$(["config-panel settings-panel",`theme-${r(n)}`]),onClick:e[8]||(e[8]=D(()=>{},["stop"]))},[e[28]||(e[28]=o("div",{class:"panel-header"},[o("span",{class:"panel-title"},"编辑器属性")],-1)),o("div",Ke,[o("div",Ge,[e[21]||(e[21]=o("span",{class:"setting-label"},"主题色",-1)),o("div",Ze,[A(o("input",{type:"color","onUpdate:modelValue":e[3]||(e[3]=t=>p.value.primaryColor=t),onInput:e[4]||(e[4]=t=>H(p.value.primaryColor)),class:"color-input"},null,544),[[ee,p.value.primaryColor]]),o("span",Qe,I(p.value.primaryColor),1)])]),o("div",We,[e[23]||(e[23]=o("span",{class:"setting-label"},"自动隐藏工具栏",-1)),o("div",{class:$(["toggle-switch",{on:p.value.autoHide}]),onClick:e[5]||(e[5]=t=>p.value.autoHide=!p.value.autoHide)},[...e[22]||(e[22]=[o("div",{class:"toggle-thumb"},null,-1)])],2)]),o("div",Xe,[e[25]||(e[25]=o("span",{class:"setting-label"},"响应式布局",-1)),o("div",{class:$(["toggle-switch",{on:p.value.responsive}]),onClick:e[6]||(e[6]=t=>p.value.responsive=!p.value.responsive)},[...e[24]||(e[24]=[o("div",{class:"toggle-thumb"},null,-1)])],2)]),o("div",Ye,[e[26]||(e[26]=o("span",{class:"setting-label"},"历史记录数",-1)),o("div",eo,[A(o("input",{type:"range","onUpdate:modelValue":e[7]||(e[7]=t=>p.value.historyLimit=t),min:"10",max:"100",step:"10",class:"range-slider"},null,512),[[ee,p.value.historyLimit,void 0,{number:!0}]]),o("span",oo,I(p.value.historyLimit),1)])]),e[27]||(e[27]=o("div",{class:"setting-hint"},"部分属性需重新初始化才能生效",-1))])],2)):B("",!0)]),_:1})]),o("button",{class:"theme-btn",onClick:e[9]||(e[9]=D((...t)=>r(m)&&r(m)(...t),["stop"])),title:r(n)==="dark"?"切换亮色主题":"切换暗色主题"},[r(n)==="dark"?(C(),N(r(fe),{key:0,size:18})):(C(),N(r(he),{key:1,size:18}))],8,to),o("label",{class:"upload-btn",onClick:e[10]||(e[10]=D(()=>{},["stop"]))},[o("input",{type:"file",accept:"image/*",onChange:Z,hidden:""},null,32),z(r(ke),{size:18}),e[29]||(e[29]=o("span",null,"上传图片",-1))]),o("button",{class:"save-btn",onClick:D(W,["stop"])},[z(r(xe),{size:18}),e[30]||(e[30]=o("span",null,"保存",-1))])]),(C(),N(ye,{to:"body"},[R.value?(C(),U("div",{key:0,class:"preview-overlay",onClick:D(te,["self"])},[o("div",{class:$(["preview-dialog",`theme-${r(n)}`])},[o("div",ao,[e[32]||(e[32]=o("h2",null,"图片预览",-1)),o("button",{class:"close-btn",onClick:te},[z(r(Te),{size:20})])]),o("div",so,[o("div",lo,[o("img",{src:u.value,alt:"Preview",class:"preview-image"},null,8,no)]),o("div",io,[o("label",ro,[A(o("input",{type:"radio","onUpdate:modelValue":e[12]||(e[12]=t=>b.value=t),value:"png"},null,512),[[le,b.value]]),e[33]||(e[33]=o("span",{class:"format-label"},"PNG",-1)),e[34]||(e[34]=o("span",{class:"format-desc"},"无损压缩，支持透明",-1))]),o("label",uo,[A(o("input",{type:"radio","onUpdate:modelValue":e[13]||(e[13]=t=>b.value=t),value:"jpeg"},null,512),[[le,b.value]]),e[35]||(e[35]=o("span",{class:"format-label"},"JPG",-1)),e[36]||(e[36]=o("span",{class:"format-desc"},"文件更小，适合照片",-1))])]),b.value==="jpeg"?(C(),U("div",vo,[o("span",po,"质量: "+I(Math.round(E.value*100))+"%",1),A(o("input",{type:"range","onUpdate:modelValue":e[14]||(e[14]=t=>E.value=t),min:"0.1",max:"1",step:"0.05"},null,512),[[ee,E.value,void 0,{number:!0}]])])):B("",!0),o("div",co,[o("div",mo,[e[37]||(e[37]=o("span",{class:"info-label"},"尺寸",-1)),o("span",go,I(x.value.width)+" × "+I(x.value.height),1)]),o("div",fo,[e[38]||(e[38]=o("span",{class:"info-label"},"大小",-1)),o("span",ho,I(x.value.size),1)]),o("div",yo,[e[39]||(e[39]=o("span",{class:"info-label"},"格式",-1)),o("span",wo,I(b.value.toUpperCase()),1)])])]),o("div",bo,[o("button",{class:"action-btn",onClick:ue,disabled:!l.value},[P.value?(C(),N(r(Ee),{key:0,size:18})):(C(),N(r(_e),{key:1,size:18})),o("span",null,I(P.value?"已复制":"复制"),1)],8,Co),o("button",{class:"action-btn",onClick:de,disabled:!u.value},[z(r(ze),{size:18}),e[40]||(e[40]=o("span",null,"下载",-1))],8,ko),o("button",{class:"action-btn primary",onClick:ve,disabled:!l.value||j.value},[z(r(Ie),{size:18}),o("span",null,I(j.value?"上传中...":"上传到服务器"),1)],8,xo)])],2)])):B("",!0)])),o("main",{class:"editor-container",onDrop:D(Q,["prevent"]),onDragover:e[15]||(e[15]=D(()=>{},["prevent"]))},[z(r(Ve),{ref_key:"editorRef",ref:s,image:h.value,plugins:F,options:V.value,onReady:y},null,8,["image","options"])],32)],2))}}),Uo=we(To,[["__scopeId","data-v-e9026144"]]);export{Uo as default};
