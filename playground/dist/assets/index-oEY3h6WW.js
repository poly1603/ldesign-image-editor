import{d as fe,r as p,c as J,o as ye,w as K,a as we,b as C,e as s,f as k,g as b,h as N,u as l,R as Ce,i as f,n as g,T as A,j as ke,S as xe,M as he,k as j,l as U,v as G,t as v,m as V,p as ze,q as u,F as W,s as Z,_ as $e}from"./index-SE0NJIgO.js";import{S as Te,U as De,a as Ue,X as Pe,D as Se,C as Ie,c as Be,Z as Q,K as X,J as Fe}from"./index.es-DlIkaE_g.js";import{S as je}from"./settings-DPy8mNFk.js";import{C as Y,a as ee}from"./copy-C5UYAKMA.js";import{C as Le}from"./chevron-left-CnZcR3IB.js";const _e={class:"panel-trigger"},Re={class:"panel-body"},Me={class:"group-label"},Ne={class:"toggle-list"},Ve=["onClick"],Oe={class:"toggle-name"},Ee={class:"panel-trigger"},He={class:"panel-body"},qe={class:"setting-item"},Je={class:"color-picker-row"},Ke={class:"color-value"},Ae={class:"setting-item"},Ge={class:"setting-item"},We={class:"setting-item"},Ze={class:"range-row"},Qe={class:"range-value"},Xe=["title"],Ye={class:"preview-header"},es={class:"preview-content"},ss={class:"preview-image-wrapper"},ts=["src"],as={class:"format-selector"},ls={class:"format-option"},os={class:"format-option"},ns={key:0,class:"quality-slider"},is={class:"quality-label"},rs={class:"preview-info"},us={class:"info-item"},ds={class:"info-value"},ps={class:"info-item"},vs={class:"info-value"},cs={class:"info-item"},ms={class:"info-value"},gs={class:"info-item"},bs={class:"info-value"},fs={class:"export-data-section"},ys={class:"export-data-tabs"},ws={class:"export-data-content"},Cs={class:"export-code"},ks={class:"preview-actions"},xs=["disabled"],hs=["disabled"],zs=["disabled"],$s=fe({__name:"index",setup(Ts){const L=p(null);let o=null,n=null;const{theme:y,toggleTheme:O}=ke(),h=p(null),P=J({get:()=>h.value==="tools",set:t=>h.value=t?"tools":null}),S=J({get:()=>h.value==="settings",set:t=>h.value=t?"settings":null}),se=[{group:"缩放控件",items:[{id:"zoomOut",name:"缩小"},{id:"zoomIn",name:"放大"},{id:"reset",name:"重置"}]},{group:"绘图工具",items:[{id:"move",name:"移动"},{id:"pen",name:"画笔"},{id:"rect",name:"矩形"},{id:"circle",name:"圆形"},{id:"arrow",name:"箭头"},{id:"line",name:"直线"},{id:"triangle",name:"三角形"},{id:"text",name:"文字",plugin:X},{id:"mosaic",name:"马赛克",plugin:Q},{id:"eraser",name:"橡皮擦"}]},{group:"图像工具",items:[{id:"crop",name:"裁剪"},{id:"filter",name:"滤镜"}]},{group:"历史记录",items:[{id:"undo",name:"撤销"},{id:"redo",name:"重做"}]},{group:"导出",items:[{id:"export",name:"导出"}]}],z=p(["zoomOut","zoomIn","reset","move","pen","rect","circle","arrow","line","triangle","mosaic","eraser","crop","filter","undo","redo","export"]),d=p({autoHide:!0,historyLimit:50,responsive:!0,primaryColor:"#667eea"}),te=[Q,X,Fe],I=p(!1),i=p(""),c=p(null),$=p({width:0,height:0,size:""}),B=p(!1),_=p(!1),m=p("png"),T=p(.92),F=p(!1),w=p("base64"),E=()=>["zoomOut","zoomIn","reset","move","pen","rect","circle","arrow","line","triangle","text","mosaic","eraser","crop","filter","undo","redo","export"].filter(e=>!z.value.includes(e)),ae=()=>{L.value&&(o&&o.destroy(),o=new Be({container:L.value,plugins:te,historyLimit:50,responsive:!0,toolbar:{theme:y.value,autoHide:!0,disabledTools:E()}}),n=o._toolbar)};ye(()=>{ae()}),K(y,t=>{n==null||n.setTheme(t),n!=null&&n.hasImage()||n==null||n.showPlaceholder()});const le=t=>{const e=z.value.indexOf(t);e>-1?z.value.splice(e,1):z.value.push(t),n==null||n.setDisabledTools(E())},oe=t=>{d.value.primaryColor=t,n==null||n.setPrimaryColor(t)},ne=()=>{h.value=null};we(()=>{o==null||o.destroy()});const ie=async t=>{var x;const e=t.target,a=(x=e.files)==null?void 0:x[0];if(!a||!o)return;const r=new FileReader;r.onload=async R=>{var D;const M=(D=R.target)==null?void 0:D.result;await(o==null?void 0:o.loadImage(M))},r.readAsDataURL(a),e.value=""},re=async t=>{var r,x;t.preventDefault();const e=(x=(r=t.dataTransfer)==null?void 0:r.files)==null?void 0:x[0];if(!(e!=null&&e.type.startsWith("image/"))||!o)return;const a=new FileReader;a.onload=async R=>{var D;const M=(D=R.target)==null?void 0:D.result;await(o==null?void 0:o.loadImage(M))},a.readAsDataURL(e)},ue=async()=>{o&&(await H(),I.value=!0)},H=async()=>{if(o)try{const t=m.value,e=t==="jpeg"?T.value:void 0,a=await o.export({format:t,type:"base64",quality:e});i.value=a,c.value=await o.export({format:t,type:"blob",quality:e});const r=o.getImageInfo();$.value={width:r.width,height:r.height,size:de(c.value.size)}}catch(t){console.error("Failed to export image:",t)}};K([m,T],()=>{I.value&&H()});const de=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(2)+" MB",pe=t=>t.toLocaleString(),ve=()=>{if(!i.value)return"";switch(w.value){case"base64":return(i.value.split(",")[1]||"").substring(0,80)+"...";case"dataurl":return i.value.substring(0,80)+"...";case"blob":return c.value?`Blob { size: ${c.value.size}, type: "${c.value.type}" }`:"No blob available";default:return""}},ce=async()=>{var e,a;if(!i.value)return;let t="";switch(w.value){case"base64":t=i.value;break;case"dataurl":t=i.value;break;case"blob":t=`// Convert Data URL to Blob
const dataUrl = '...'  // 粘贴你的 Data URL
const response = await fetch(dataUrl);
const blob = await response.blob();
// blob.size: ${((e=c.value)==null?void 0:e.size)||0}
// blob.type: "${((a=c.value)==null?void 0:a.type)||""}" `;break}try{await navigator.clipboard.writeText(t),_.value=!0,setTimeout(()=>{_.value=!1},2e3)}catch(r){console.error("Failed to copy:",r)}},me=()=>{if(!i.value)return;const t=m.value==="jpeg"?"jpg":"png",e=document.createElement("a");e.href=i.value,e.download=`image-${Date.now()}.${t}`,e.click()},ge=async()=>{if(c.value)try{const t=m.value==="jpeg"?"image/jpeg":"image/png";await navigator.clipboard.write([new ClipboardItem({[t]:c.value})]),B.value=!0,setTimeout(()=>{B.value=!1},2e3)}catch(t){console.error("Failed to copy:",t)}},q=()=>{I.value=!1,i.value="",c.value=null},be=async()=>{if(!(!c.value||!i.value)){F.value=!0;try{const t=m.value==="jpeg"?"jpg":"png",e=`image-${Date.now()}.${t}`;alert(`上传方式 1️⃣ FormData (推荐):

const formData = new FormData();
formData.append('file', blob, '${e}');

const response = await fetch('/api/upload', {
  method: 'POST',
  body: formData,
});

上传方式 2️⃣ Base64:

const base64 = '${i.value.substring(0,50)}...';

const response = await fetch('/api/upload', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    image: base64,
    filename: '${e}',
  }),
});

图片信息:
- 文件名: ${e}
- 格式: ${m.value.toUpperCase()}
- 大小: ${$.value.size}
- Base64 长度: ${i.value.length} 字符`)}catch(t){console.error("Upload failed:",t),alert("上传失败: "+t.message)}finally{F.value=!1}}};return(t,e)=>(u(),C("div",{class:g(["editor-page",`theme-${l(y)}`]),onClick:ne},[s("header",{class:"editor-header",onClick:e[11]||(e[11]=f(()=>{},["stop"]))},[b(l(Ce),{to:"/",class:"back-btn"},{default:N(()=>[b(l(Le),{size:20}),e[19]||(e[19]=s("span",null,"返回",-1))]),_:1}),e[34]||(e[34]=s("h1",{class:"title"},"图片编辑器 - Native Demo",-1)),s("div",_e,[s("button",{class:g(["header-btn",{active:P.value}]),onClick:e[0]||(e[0]=f(a=>P.value=!P.value,["stop"]))},[b(l(je),{size:18}),e[20]||(e[20]=s("span",null,"工具配置",-1))],2),b(A,{name:"panel-fade"},{default:N(()=>[P.value?(u(),C("div",{key:0,class:g(["config-panel",`theme-${l(y)}`]),onClick:e[1]||(e[1]=f(()=>{},["stop"]))},[e[22]||(e[22]=s("div",{class:"panel-header"},[s("span",{class:"panel-title"},"工具栏配置")],-1)),s("div",Re,[(u(),C(W,null,Z(se,a=>s("div",{key:a.group,class:"config-group"},[s("div",Me,v(a.group),1),s("div",Ne,[(u(!0),C(W,null,Z(a.items,r=>(u(),C("div",{key:r.id,class:"toggle-item",onClick:x=>le(r.id)},[s("span",Oe,v(r.name),1),s("div",{class:g(["toggle-switch",{on:z.value.includes(r.id)}])},[...e[21]||(e[21]=[s("div",{class:"toggle-thumb"},null,-1)])],2)],8,Ve))),128))])])),64))])],2)):j("",!0)]),_:1})]),s("div",Ee,[s("button",{class:g(["header-btn",{active:S.value}]),onClick:e[2]||(e[2]=f(a=>S.value=!S.value,["stop"]))},[b(l(Te),{size:18}),e[23]||(e[23]=s("span",null,"属性",-1))],2),b(A,{name:"panel-fade"},{default:N(()=>[S.value?(u(),C("div",{key:0,class:g(["config-panel settings-panel",`theme-${l(y)}`]),onClick:e[8]||(e[8]=f(()=>{},["stop"]))},[e[31]||(e[31]=s("div",{class:"panel-header"},[s("span",{class:"panel-title"},"编辑器属性")],-1)),s("div",He,[s("div",qe,[e[24]||(e[24]=s("span",{class:"setting-label"},"主题色",-1)),s("div",Je,[U(s("input",{type:"color","onUpdate:modelValue":e[3]||(e[3]=a=>d.value.primaryColor=a),onInput:e[4]||(e[4]=a=>oe(d.value.primaryColor)),class:"color-input"},null,544),[[V,d.value.primaryColor]]),s("span",Ke,v(d.value.primaryColor),1)])]),s("div",Ae,[e[26]||(e[26]=s("span",{class:"setting-label"},"自动隐藏工具栏",-1)),s("div",{class:g(["toggle-switch",{on:d.value.autoHide}]),onClick:e[5]||(e[5]=a=>d.value.autoHide=!d.value.autoHide)},[...e[25]||(e[25]=[s("div",{class:"toggle-thumb"},null,-1)])],2)]),s("div",Ge,[e[28]||(e[28]=s("span",{class:"setting-label"},"响应式布局",-1)),s("div",{class:g(["toggle-switch",{on:d.value.responsive}]),onClick:e[6]||(e[6]=a=>d.value.responsive=!d.value.responsive)},[...e[27]||(e[27]=[s("div",{class:"toggle-thumb"},null,-1)])],2)]),s("div",We,[e[29]||(e[29]=s("span",{class:"setting-label"},"历史记录数",-1)),s("div",Ze,[U(s("input",{type:"range","onUpdate:modelValue":e[7]||(e[7]=a=>d.value.historyLimit=a),min:"10",max:"100",step:"10",class:"range-slider"},null,512),[[V,d.value.historyLimit,void 0,{number:!0}]]),s("span",Qe,v(d.value.historyLimit),1)])]),e[30]||(e[30]=s("div",{class:"setting-hint"},"部分属性需重新初始化才能生效",-1))])],2)):j("",!0)]),_:1})]),s("button",{class:"theme-btn",onClick:e[9]||(e[9]=f((...a)=>l(O)&&l(O)(...a),["stop"])),title:l(y)==="dark"?"切换亮色主题":"切换暗色主题"},[l(y)==="dark"?(u(),k(l(xe),{key:0,size:18})):(u(),k(l(he),{key:1,size:18}))],8,Xe),s("label",{class:"upload-btn",onClick:e[10]||(e[10]=f(()=>{},["stop"]))},[s("input",{type:"file",accept:"image/*",onChange:ie,hidden:""},null,32),b(l(De),{size:18}),e[32]||(e[32]=s("span",null,"上传图片",-1))]),s("button",{class:"save-btn",onClick:f(ue,["stop"])},[b(l(Ue),{size:18}),e[33]||(e[33]=s("span",null,"保存",-1))])]),(u(),k(ze,{to:"body"},[I.value?(u(),C("div",{key:0,class:"preview-overlay",onClick:f(q,["self"])},[s("div",{class:g(["preview-dialog",`theme-${l(y)}`])},[s("div",Ye,[e[35]||(e[35]=s("h2",null,"图片预览",-1)),s("button",{class:"close-btn",onClick:q},[b(l(Pe),{size:20})])]),s("div",es,[s("div",ss,[s("img",{src:i.value,alt:"Preview",class:"preview-image"},null,8,ts)]),s("div",as,[s("label",ls,[U(s("input",{type:"radio","onUpdate:modelValue":e[12]||(e[12]=a=>m.value=a),value:"png"},null,512),[[G,m.value]]),e[36]||(e[36]=s("span",{class:"format-label"},"PNG",-1)),e[37]||(e[37]=s("span",{class:"format-desc"},"无损压缩，支持透明",-1))]),s("label",os,[U(s("input",{type:"radio","onUpdate:modelValue":e[13]||(e[13]=a=>m.value=a),value:"jpeg"},null,512),[[G,m.value]]),e[38]||(e[38]=s("span",{class:"format-label"},"JPG",-1)),e[39]||(e[39]=s("span",{class:"format-desc"},"文件更小，适合照片",-1))])]),m.value==="jpeg"?(u(),C("div",ns,[s("span",is,"质量: "+v(Math.round(T.value*100))+"%",1),U(s("input",{type:"range","onUpdate:modelValue":e[14]||(e[14]=a=>T.value=a),min:"0.1",max:"1",step:"0.05"},null,512),[[V,T.value,void 0,{number:!0}]])])):j("",!0),s("div",rs,[s("div",us,[e[40]||(e[40]=s("span",{class:"info-label"},"尺寸",-1)),s("span",ds,v($.value.width)+" × "+v($.value.height),1)]),s("div",ps,[e[41]||(e[41]=s("span",{class:"info-label"},"文件大小",-1)),s("span",vs,v($.value.size),1)]),s("div",cs,[e[42]||(e[42]=s("span",{class:"info-label"},"MIME 类型",-1)),s("span",ms,"image/"+v(m.value==="jpeg"?"jpeg":"png"),1)]),s("div",gs,[e[43]||(e[43]=s("span",{class:"info-label"},"Base64 长度",-1)),s("span",bs,v(pe(i.value.length))+" 字符",1)])]),s("div",fs,[e[44]||(e[44]=s("div",{class:"export-data-header"},[s("span",{class:"export-data-title"},"导出数据")],-1)),s("div",ys,[s("button",{class:g(["export-tab",{active:w.value==="base64"}]),onClick:e[15]||(e[15]=a=>w.value="base64")},"Base64",2),s("button",{class:g(["export-tab",{active:w.value==="dataurl"}]),onClick:e[16]||(e[16]=a=>w.value="dataurl")},"Data URL",2),s("button",{class:g(["export-tab",{active:w.value==="blob"}]),onClick:e[17]||(e[17]=a=>w.value="blob")},"Blob",2)]),s("div",ws,[s("code",Cs,v(ve()),1),s("button",{class:"copy-code-btn",onClick:ce},[_.value?(u(),k(l(Y),{key:0,size:14})):(u(),k(l(ee),{key:1,size:14}))])])])]),s("div",ks,[s("button",{class:"action-btn",onClick:ge,disabled:!c.value},[B.value?(u(),k(l(Y),{key:0,size:18})):(u(),k(l(ee),{key:1,size:18})),s("span",null,v(B.value?"已复制图片":"复制图片"),1)],8,xs),s("button",{class:"action-btn",onClick:me,disabled:!i.value},[b(l(Se),{size:18}),s("span",null,"下载 "+v(m.value.toUpperCase()),1)],8,hs),s("button",{class:"action-btn primary",onClick:be,disabled:!c.value||F.value},[b(l(Ie),{size:18}),s("span",null,v(F.value?"上传中...":"上传到服务器"),1)],8,zs)])],2)])):j("",!0)])),s("main",{ref_key:"containerRef",ref:L,class:"editor-container",onDrop:f(re,["prevent"]),onDragover:e[18]||(e[18]=f(()=>{},["prevent"]))},null,544)],2))}}),Bs=$e($s,[["__scopeId","data-v-d101b76d"]]);export{Bs as default};
