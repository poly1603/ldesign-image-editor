(function(g,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("@ldesign/image-editor")):typeof define=="function"&&define.amd?define(["exports","vue","@ldesign/image-editor"],e):(g=typeof globalThis<"u"?globalThis:g||self,e(g.ImageEditorVue={},g.Vue,g.LDesignImageEditor))})(this,function(g,e,V){"use strict";function S(r={}){const o=e.shallowRef(null),u=e.ref(!1),d=e.ref(!1),a=e.ref(null),h=e.ref(null),n=e.ref(!1),i=e.ref(!1),c=e.ref(0),l=e.ref(0);function m(f){o.value&&v();try{const t={container:f,width:r.width,height:r.height,plugins:r.plugins,image:r.image,...r.options},p=new V.Editor(t);o.value=p,E(p),c.value=p.width,l.value=p.height}catch(t){throw a.value=t instanceof Error?t:new Error(String(t)),t}}function E(f){f.on("ready",t=>{u.value=!0,d.value=!1,c.value=t.width,l.value=t.height}),f.on("error",t=>{a.value=t.error,d.value=!1}),f.on("tool-change",t=>{h.value=t.tool||null}),f.on("history-change",t=>{n.value=t.canUndo,i.value=t.canRedo}),f.on("image-loaded",t=>{c.value=t.width,l.value=t.height})}async function w(f){if(!o.value)throw new Error("Editor not initialized");d.value=!0,a.value=null;try{await o.value.loadImage(f)}catch(t){throw a.value=t instanceof Error?t:new Error(String(t)),t}finally{d.value=!1}}async function x(f){if(!o.value)throw new Error("Editor not initialized");return o.value.export(f)}function I(){o.value&&o.value.undo()}function _(){o.value&&o.value.redo()}function y(f){o.value&&o.value.setTool(f)}function v(){o.value&&(o.value.destroy(),o.value=null,u.value=!1,d.value=!1,a.value=null,h.value=null,n.value=!1,i.value=!1,c.value=0,l.value=0)}return e.onUnmounted(()=>{v()}),{editor:o,isReady:u,isLoading:d,error:a,currentTool:h,canUndo:n,canRedo:i,width:c,height:l,init:m,loadImage:w,exportImage:x,undo:I,redo:_,setTool:y,destroy:v}}function L(r){const o=[];function u(n){return i=>d(n,i)}function d(n,i){r.value&&r.value.on(n,i),o.push({event:n,handler:i});const c=e.watch(()=>r.value,(l,m)=>{m&&m.off(n,i),l&&l.on(n,i)});return()=>{c(),r.value&&r.value.off(n,i);const l=o.findIndex(m=>m.event===n&&m.handler===i);l!==-1&&o.splice(l,1)}}function a(n,i){r.value&&r.value.off(n,i);const c=o.findIndex(l=>l.event===n&&l.handler===i);c!==-1&&o.splice(c,1)}function h(){if(r.value)for(const{event:n,handler:i}of o)r.value.off(n,i);o.length=0}return e.onUnmounted(()=>{h()}),{onReady:u("ready"),onError:u("error"),onImageLoaded:u("image-loaded"),onToolChange:u("tool-change"),onHistoryChange:u("history-change"),onBeforeExport:u("before-export"),onAfterExport:u("after-export"),onDestroy:u("destroy"),on:d,off:a,removeAllListeners:h}}const C={class:"image-editor-error"},k=((r,o)=>{const u=r.__vccOpts||r;for(const[d,a]of o)u[d]=a;return u})(e.defineComponent({__name:"ImageEditor",props:{image:{default:void 0},width:{default:void 0},height:{default:void 0},plugins:{default:()=>[]},options:{default:()=>({})}},emits:["ready","error","tool-change","history-change","image-loaded","before-export","after-export","destroy"],setup(r,{expose:o,emit:u}){const d=r,a=u,h=e.ref(),{editor:n,isReady:i,isLoading:c,error:l,currentTool:m,canUndo:E,canRedo:w,width:x,height:I,init:_,loadImage:y,exportImage:v,undo:f,redo:t,setTool:p,destroy:U}=S({image:d.image,width:d.width,height:d.height,plugins:d.plugins,options:d.options}),{onReady:O,onError:R,onImageLoaded:b,onToolChange:B,onHistoryChange:D,onBeforeExport:H,onAfterExport:A,onDestroy:j}=L(n);return O(s=>a("ready",s)),R(s=>a("error",s)),b(s=>a("image-loaded",s)),B(s=>a("tool-change",s)),D(s=>a("history-change",s)),H(s=>a("before-export",s)),A(s=>a("after-export",s)),j(()=>a("destroy")),e.onMounted(()=>{h.value&&_(h.value)}),e.watch(()=>d.image,async s=>{if(s&&n.value)try{await y(s)}catch{}}),e.onUnmounted(()=>{U()}),o({editor:n,isReady:i,isLoading:c,error:l,currentTool:m,canUndo:E,canRedo:w,width:x,height:I,loadImage:y,export:v,undo:f,redo:t,setTool:p}),(s,T)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"containerRef",ref:h,class:"image-editor-container"},[e.unref(c)?e.renderSlot(s.$slots,"loading",{key:0},()=>[T[0]||(T[0]=e.createElementVNode("div",{class:"image-editor-loading"},"Loading...",-1))],!0):e.createCommentVNode("",!0),e.unref(l)?e.renderSlot(s.$slots,"error",{key:1,error:e.unref(l)},()=>[e.createElementVNode("div",C,e.toDisplayString(e.unref(l).message),1)],!0):e.createCommentVNode("",!0)],512))}}),[["__scopeId","data-v-68e27f8f"]]),N="0.2.0";g.ImageEditor=k,g.VERSION=N,g.useEditorEvents=L,g.useImageEditor=S,Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
